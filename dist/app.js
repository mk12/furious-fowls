"use strict";(()=>{var ce=Object.defineProperty;var ze=(t,e,o)=>e in t?ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var a=(t,e)=>{for(var o in e)ce(t,o,{get:e[o],enumerable:!0})};var h=(t,e,o)=>(ze(t,typeof e!="symbol"?e+"":e,o),o);var me="#74BCE8",we="#418A4E";var v={rx:0,ry:0},$={rx:.5,ry:0},H={rx:1,ry:0};var i={rx:.5,ry:.5};var V={rx:0,ry:1},xe={rx:.5,ry:1};function X(t,e,o){let{rx:r,ry:s}=t.from??v,{rx:x,ry:p}=t.anchor??{rx:r,ry:s},{rx:q,ry:Ae}=o??v;return{x:r*width-(x-q)*e.width+(t.x??0),y:s*height-(p-Ae)*e.height+(t.y??0)}}function l(t,e){let{x:o,y:r}=X(e,t);image(t,o,r)}function F(t,e){if(e.anchor!==void 0)throw new Error("textAt does not support anchors");let{x:o,y:r}=X(e,{width:0,height:0});text(t,o,r)}function Ke(t,{x:e,y:o,w:r,h:s}){return t.x>=e&&t.x<=e+r&&t.y>=o&&t.y<=o+s}function Oe(t,{x:e,y:o,r}){return(t.x-e)**2+(t.y-o)**2<=r**2}function ue(t,e,o){switch(e){case"rect":return Ke(t,o);case"circle":return Oe(t,We(o))}}function We(t){let{x:e,y:o,w:r,h:s}=t;if(r!==s)throw new Error("bounds must be square");let x=r/2;return{x:e+x,y:o+x,r:x}}function R(t,e){for(let o=t.length-1;o>=0;o--)e(t[o])}function j(t,e){let o={};for(let r of t)o[r]=e(r);return o}var fe=new Map;function G(t){t=t.toLowerCase();let e=fe.get(t);return e===void 0&&(e=loadImage(`images/${t}.png`),fe.set(t,e)),e}function u(...t){return j(t,G)}function N(t){push(),fill(0,150),noStroke(),rect(0,0,width,height),pop(),l(t,{from:i})}var g=class{img=u("title");draw(){l(this.img.title,{y:20,from:$})}};var be=new Map;function U(t){let e=be.get(t);return e===void 0&&(e=new t,be.set(t,e)),e}var f=[];function k(){if(f.length===0)throw new Error("navigation stack is empty");return f[f.length-1]}function Y(t){let e=t.layers??[t];if(!e.includes(t))throw new Error(`${t.name}.layers does not include itself`);return e.flatMap(o=>o===t?[t]:Y(o))}function d(t,...[e]){f.push(Y(t).map(U));let o=U(t);for(let r of k())r.onShow?.(r===o?e:void 0)}function ve(){if(f.length===0)throw new Error("navigation stack is empty");if(f.length===1)throw new Error("cannot pop to an empty navigation stack");f.pop()}function ge(t,e){t.setup=()=>{e.setup(),d(e.view),setTimeout(()=>e.preload.flatMap(Y).forEach(U),200)},t.draw=()=>{e.draw(),k().forEach(o=>o.draw())},t.keyPressed=()=>R(k(),o=>o.keyPressed?.()),t.keyReleased=()=>R(k(),o=>o.keyReleased?.()),t.mousePressed=()=>R(k(),o=>o.mousePressed?.()),t.mouseReleased=()=>R(k(),o=>o.mouseReleased?.())}function b(...t){return j(t,e=>new y(e))}var y=class{state;enabled=!0;states;images;placement;constructor(...e){this.states=[],this.images={};let o=r=>typeof r=="string"?[r,!1]:[r.disabled,!0];for(let[r,s]of e.map(o))this.states.push(r),this.images[r]={normal:G(r),hover:s?void 0:G(`${r}_hover`)};this.state=this.states[0]}copy(){return Object.create(this)}place(e,o){if(this.placement!==void 0)throw new Error("already placed button");return this.placement={coord:e,shape:o??"rect"},this}cycle(){let e=this.states.indexOf(this.state);this.state=this.states[(e+1)%this.states.length]}toggle(){if(this.states.length!==2)throw new Error("toggle requires 2 states");this.cycle()}pair(){return this.images[this.state]}coord(){if(this.placement===void 0)throw new Error("button not placed");return this.placement.coord}shape(){if(this.placement===void 0)throw new Error("button not placed");return this.placement.shape}resolve(e){let o=this.pair().normal;return X(this.coord(),o,e)}draw(){if(this.coord===void 0)throw new Error("button not placed");let e=this.pair();l(this.hover()?e.hover:e.normal,this.coord())}hover(){let e=this.pair();if(!this.enabled||e.hover===void 0)return!1;let o={x:mouseX,y:mouseY},r={...this.resolve(v),w:e.normal.width,h:e.normal.height};return ue(o,this.shape(),r)}},c=class{btn=b("back");constructor(){this.btn.back.place({x:12,y:12},"circle")}draw(){this.btn.back.draw()}mousePressed(){this.btn.back.hover()&&ve()}};var J={};a(J,{birds:()=>He,blocks:()=>je,default:()=>Ge,pigs:()=>Xe,start:()=>$e});var $e=594,He=5,Xe=[{x:427,y:30},{x:662,y:30},{x:812,y:30},{x:621,y:320},{x:185,y:210},{x:163,y:285}],je=[{type:"lead",x:540,y:45,w:137,h:89},{type:"lead",x:163,y:71,w:126,h:139},{type:"lead",x:551,y:115,w:34,h:44},{type:"lead",x:515,y:183,w:293,h:92},{type:"lead",x:282,y:209,w:38,h:417},{type:"wood",x:344,y:44,w:95,h:87},{type:"steel",x:515,y:346,w:282,h:42},{type:"steel",x:497,y:425,w:239,h:51},{type:"lead",x:223,y:377,w:186,h:144},{type:"wood",x:511,y:267,w:202,h:105},{type:"wood",x:418,y:406,w:132,h:40}],Ge={start:$e,birds:He,pigs:Xe,blocks:je};var Q={};a(Q,{birds:()=>qe,blocks:()=>Ue,default:()=>Ye,pigs:()=>Fe,start:()=>Ne});var Ne=900,qe=3,Fe=[{x:155,y:30},{x:265,y:30}],Ue=[{type:"steel",x:110,y:75,w:20,h:150},{type:"steel",x:210,y:75,w:20,h:150},{type:"steel",x:310,y:75,w:20,h:150},{type:"steel",x:155,y:160,w:110,h:20},{type:"steel",x:265,y:160,w:110,h:20},{type:"wood",x:160,y:245,w:20,h:150},{type:"wood",x:260,y:245,w:20,h:150},{type:"lead",x:210,y:330,w:130,h:20}],Ye={start:Ne,birds:qe,pigs:Fe,blocks:Ue};var Z={};a(Z,{birds:()=>Qe,blocks:()=>_e,default:()=>et,pigs:()=>Ze,start:()=>Je});var Je=900,Qe=3,Ze=[{x:155,y:30},{x:265,y:30}],_e=[{type:"steel",x:110,y:75,w:20,h:150},{type:"steel",x:210,y:75,w:20,h:150},{type:"steel",x:310,y:75,w:20,h:150},{type:"steel",x:155,y:160,w:110,h:20},{type:"steel",x:265,y:160,w:110,h:20},{type:"wood",x:160,y:245,w:20,h:150},{type:"wood",x:260,y:245,w:20,h:150},{type:"lead",x:210,y:330,w:130,h:20}],et={start:Je,birds:Qe,pigs:Ze,blocks:_e};var _={};a(_,{birds:()=>ot,blocks:()=>st,default:()=>it,pigs:()=>rt,start:()=>tt});var tt=1e3,ot=2,rt=[{x:55,y:30},{x:165,y:30}],st=[{type:"steel",x:10,y:75,w:20,h:150},{type:"steel",x:110,y:75,w:20,h:150},{type:"steel",x:210,y:75,w:20,h:150},{type:"steel",x:55,y:160,w:110,h:20},{type:"steel",x:165,y:160,w:110,h:20},{type:"wood",x:60,y:245,w:20,h:150},{type:"wood",x:160,y:245,w:20,h:150},{type:"lead",x:110,y:330,w:130,h:20}],it={start:tt,birds:ot,pigs:rt,blocks:st};var ee={};a(ee,{birds:()=>at,blocks:()=>dt,default:()=>pt,pigs:()=>lt,start:()=>nt});var nt=1200,at=3,lt=[{x:100,y:30},{x:200,y:290}],dt=[{type:"lead",x:10,y:50,w:20,h:100},{type:"lead",x:190,y:50,w:20,h:100},{type:"steel",x:100,y:110,w:200,h:20},{type:"wood",x:10,y:170,w:20,h:100},{type:"wood",x:100,y:170,w:20,h:100},{type:"wood",x:190,y:170,w:20,h:100},{type:"steel",x:100,y:230,w:200,h:20},{type:"lead",x:200,y:250,w:200,h:20},{type:"lead",x:290,y:190,w:20,h:100},{type:"lead",x:290,y:70,w:20,h:140}],pt={start:nt,birds:at,pigs:lt,blocks:dt};var te={};a(te,{birds:()=>ht,blocks:()=>mt,default:()=>wt,pigs:()=>ct,start:()=>yt});var yt=900,ht=1,ct=[{x:346,y:64}],mt=[{type:"lead",x:178,y:129,w:136,h:258},{type:"lead",x:642,y:129,w:136,h:258},{type:"lead",x:262,y:47,w:24,h:93},{type:"lead",x:290,y:47,w:20,h:93},{type:"wood",x:311,y:102,w:124,h:14},{type:"lead",x:470,y:10,w:13,h:20},{type:"lead",x:486,y:7,w:13,h:13},{type:"lead",x:454,y:7,w:13,h:13},{type:"steel",x:439,y:26,w:264,h:11},{type:"wood",x:325,y:9,w:34,h:17},{type:"lead",x:274,y:184,w:46,h:145}],wt={start:yt,birds:ht,pigs:ct,blocks:mt};var oe={};a(oe,{birds:()=>ut,blocks:()=>bt,default:()=>vt,pigs:()=>ft,start:()=>xt});var xt=272,ut=2,ft=[{x:1135,y:71},{x:297,y:30}],bt=[{type:"wood",x:546,y:161,w:37,h:30},{type:"lead",x:1137,y:21,w:38,h:41},{type:"wood",x:617,y:136,w:387,h:17},{type:"lead",x:976,y:253,w:253,h:66},{type:"lead",x:873,y:421,w:38,h:266},{type:"lead",x:961,y:109,w:18,h:218},{type:"lead",x:1064,y:332,w:79,h:85},{type:"lead",x:598,y:58,w:12,h:115},{type:"lead",x:654,y:58,w:15,h:115},{type:"lead",x:208,y:40,w:64,h:77},{type:"lead",x:213,y:98,w:226,h:35}],vt={start:xt,birds:ut,pigs:ft,blocks:bt};var re={};a(re,{birds:()=>kt,blocks:()=>St,default:()=>Vt,pigs:()=>Lt,start:()=>gt});var gt=900,kt=3,Lt=[{x:266,y:110},{x:629,y:110},{x:450,y:201},{x:330,y:220},{x:573,y:220}],St=[{type:"steel",x:207,y:77,w:22,h:153},{type:"steel",x:328,y:77,w:22,h:153},{type:"steel",x:449,y:77,w:22,h:153},{type:"steel",x:573,y:77,w:22,h:153},{type:"steel",x:690,y:77,w:22,h:153},{type:"steel",x:268,y:163,w:147,h:19},{type:"steel",x:634,y:163,w:147,h:19},{type:"steel",x:450,y:162,w:183,h:18},{type:"wood",x:267,y:8,w:96,h:16},{type:"wood",x:632,y:8,w:96,h:16},{type:"steel",x:264,y:249,w:22,h:153},{type:"steel",x:638,y:249,w:22,h:153},{type:"steel",x:557,y:334,w:183,h:18},{type:"steel",x:344,y:334,w:183,h:18},{type:"lead",x:490,y:9,w:58,h:18},{type:"lead",x:411,y:8,w:52,h:15},{type:"wood",x:267,y:24,w:96,h:16},{type:"wood",x:267,y:40,w:96,h:16},{type:"wood",x:267,y:56,w:96,h:16},{type:"wood",x:267,y:72,w:96,h:16},{type:"wood",x:633,y:72,w:96,h:16},{type:"wood",x:633,y:56,w:96,h:16},{type:"wood",x:633,y:40,w:96,h:16},{type:"wood",x:633,y:24,w:96,h:16},{type:"lead",x:447,y:357,w:124,h:25},{type:"lead",x:244,y:258,w:16,h:171},{type:"lead",x:658,y:258,w:16,h:171},{type:"lead",x:334,y:181,w:117,h:18},{type:"lead",x:568,y:181,w:117,h:18},{type:"wood",x:372,y:369,w:24,h:51},{type:"wood",x:522,y:369,w:24,h:51},{type:"steel",x:298,y:355,w:123,h:23},{type:"steel",x:595,y:355,w:123,h:23},{type:"wood",x:404,y:296,w:19,h:55},{type:"wood",x:447,y:259,w:142,h:17},{type:"wood",x:495,y:296,w:19,h:55},{type:"wood",x:498,y:210,w:21,h:76},{type:"wood",x:405,y:210,w:21,h:76},{type:"lead",x:351,y:85,w:14,h:169}],Vt={start:gt,birds:kt,pigs:Lt,blocks:St};var se={};a(se,{birds:()=>Tt,blocks:()=>Bt,default:()=>It,pigs:()=>Ct,start:()=>Rt});var Rt=879,Tt=2,Ct=[{x:629,y:216},{x:134,y:30},{x:-11,y:30}],Bt=[{type:"lead",x:294,y:203,w:258,h:20},{type:"wood",x:262,y:96,w:23,h:192},{type:"lead",x:296,y:48,w:39,h:95},{type:"lead",x:534,y:178,w:251,h:16},{type:"lead",x:538,y:85,w:22,h:169},{type:"steel",x:188,y:251,w:52,h:73},{type:"lead",x:209,y:32,w:80,h:63},{type:"wood",x:174,y:71,w:149,h:14},{type:"steel",x:210,y:127,w:77,h:95}],It={start:Rt,birds:Tt,pigs:Ct,blocks:Bt};var ie={};a(ie,{birds:()=>Mt,blocks:()=>Dt,default:()=>At,pigs:()=>Pt,start:()=>Et});var Et=850,Mt=3,Pt=[{x:476,y:50},{x:357,y:49},{x:711,y:307},{x:615,y:593}],Dt=[{type:"lead",x:197,y:195,w:15,h:123},{type:"lead",x:255,y:169,w:15,h:110},{type:"lead",x:305,y:120,w:13,h:112},{type:"wood",x:183,y:75,w:73,h:112},{type:"wood",x:250,y:66,w:57,h:92},{type:"wood",x:300,y:41,w:36,h:42},{type:"wood",x:437,y:10,w:609,h:17},{type:"wood",x:404,y:210,w:17,h:378},{type:"wood",x:427,y:98,w:16,h:153},{type:"wood",x:479,y:186,w:121,h:16},{type:"wood",x:530,y:97,w:17,h:150},{type:"lead",x:475,y:314,w:24,h:234},{type:"steel",x:622,y:279,w:24,h:516},{type:"lead",x:692,y:148,w:102,h:256},{type:"lead",x:621,y:548,w:162,h:16},{type:"lead",x:55,y:110,w:102,h:218},{type:"lead",x:591,y:277,w:31,h:513}],At={start:Et,birds:Mt,pigs:Pt,blocks:Dt};var ne={};a(ne,{birds:()=>Kt,blocks:()=>Wt,default:()=>$t,pigs:()=>Ot,start:()=>zt});var zt=1400,Kt=4,Ot=[{x:65,y:30},{x:65,y:210},{x:280,y:30}],Wt=[{type:"steel",x:10,y:40,w:20,h:80},{type:"steel",x:120,y:40,w:20,h:80},{type:"lead",x:65,y:85,w:130,h:10},{type:"lead",x:65,y:130,w:20,h:80},{type:"wood",x:65,y:180,w:130,h:10},{type:"steel",x:10,y:230,w:20,h:80},{type:"steel",x:120,y:230,w:20,h:80},{type:"wood",x:65,y:280,w:130,h:10},{type:"steel",x:185,y:100,w:50,h:200},{type:"wood",x:185,y:210,w:50,h:20},{type:"wood",x:185,y:230,w:50,h:20},{type:"wood",x:185,y:250,w:50,h:20},{type:"lead",x:185,y:350,w:50,h:200},{type:"lead",x:220,y:40,w:20,h:80},{type:"steel",x:235,y:40,w:10,h:80},{type:"wood",x:245,y:20,w:10,h:40},{type:"wood",x:315,y:20,w:10,h:40},{type:"steel",x:325,y:40,w:10,h:80},{type:"lead",x:340,y:40,w:20,h:80},{type:"lead",x:280,y:85,w:140,h:10}],$t={start:zt,birds:Kt,pigs:Ot,blocks:Wt};var O=8;var Ht=[_,ee,te,oe,re,se,ie,ne],Xt=[J,Q,Z];function jt(t){return`custom_${t}`}function L(t){let e,o=t.number-1;switch(t.kind){case"standard":e=Ht[o];break;case"custom":e=getItem(jt(t.number))??Xt[o];break}return{desc:t,data:e}}var Gt="won",Nt="starred",Le=getItem(Gt)??0,Se=new Set(getItem(Nt)??[]);function Ve({kind:t,number:e}){if(t!=="standard")throw new Error("only standard levels have a status");return Se.has(e)?"starred":e<=Le+1?"open":"locked"}function Re(){return Se.size===O}function Te(){return{kind:"standard",number:Le%O+1}}function Ce(){return{kind:"custom",number:1}}var ae=class{img=u("openDialog","bird","slingshot");btn={...b("increment","decrement","addBlock","addPig","open","test","custom1","custom2","custom3"),cycle:new y("blockCycle0","blockCycle1","blockCycle2"),delete:new y("delete","deleteOn")};numBirds=1;opening=!1;mode="block";level;constructor(){this.btn.increment.place({x:-20,y:20,from:H}),this.btn.decrement.place({x:-20,y:20+60,from:H}),this.btn.cycle.place({x:20,y:100+20}),this.btn.addBlock.place({x:20,y:100+2*20+40}),this.btn.addPig.place({x:20,y:100+3*20+2*40}),this.btn.delete.place({x:20,y:100+4*20+3*40}),this.btn.open.place({x:20+50,y:20/2}),this.btn.test.place({x:20*2+175,y:20/2}),this.btn.custom1.place({x:-85,from:i}),this.btn.custom2.place({x:0,from:i}),this.btn.custom3.place({x:85,from:i}),this.level=void 0}onShow(e){W("edit-1")}draw(){push(),l(this.img.slingshot,{x:250,y:-83,from:V,anchor:i}),pop(),fill(we),noStroke(),rect(0,height-30,width,height),fill(0),stroke(1),textSize(35),textAlign(RIGHT),text(this.numBirds,width-30,72),l(this.img.bird,{x:-15,y:115,from:H}),this.btn.increment.draw(),this.btn.decrement.draw(),this.btn.addBlock.draw(),this.btn.addPig.draw(),this.btn.open.draw(),this.btn.test.draw(),this.btn.cycle.draw(),this.btn.delete.draw(),this.opening&&(N(this.img.openDialog),this.btn.custom1.draw(),this.btn.custom2.draw(),this.btn.custom3.draw())}mousePressed(){this.opening?(this.opening=!1,this.btn.custom1.hover()?this.openLevel(1):this.btn.custom2.hover()?this.openLevel(2):this.btn.custom3.hover()&&this.openLevel(3)):this.btn.increment.hover()?this.numBirds=min(this.numBirds+1,5):this.btn.decrement.hover()?this.numBirds=max(this.numBirds-1,1):this.btn.addBlock.hover()?this.mode="block":this.btn.addPig.hover()?this.mode="pig":this.btn.open.hover()?this.opening=!0:this.btn.test.hover()?d(n,this.level):this.btn.cycle.hover()?(this.btn.cycle.cycle(),this.mode="block"):this.btn.delete.hover()&&(this.mode="delete"),this.updateButtons()}updateButtons(){this.btn.increment.enabled=this.numBirds<5,this.btn.decrement.enabled=this.numBirds>1,this.btn.delete.state=this.mode==="delete"?"deleteOn":"delete"}openLevel(e){}},m=ae;h(m,"layers",[ae,c]);function de(){return Re()}var le="dense",Ee="true",Me=de()&&new URLSearchParams(location.search).get(le)===Ee;function Pe(){return Me}function De(t){Me=t;let e=new URLSearchParams(location.search);t?e.set(le,Ee):e.delete(le),history.replaceState({},"",`${location.pathname}${location.hash}?${e}`)}var pe=class{img=u("selectMessage");btn={...b("custom1","custom2","custom3"),level:new y("aLevel","aStarredLevel",{disabled:"aLockedLevel"}),checkbox:new y("checkbox","checkedbox")};levels=new Map;constructor(){let r,s;r=85,s=150;for(let p=0;p<O;p++)this.levels.set({kind:"standard",number:p+1},this.btn.level.copy().place({x:r,y:s})),r+=110,p%5===0&&p>0&&(r=85,s+=110);r=85,s=400;let x=[this.btn.custom1,this.btn.custom2,this.btn.custom3];for(let[p,q]of x.entries())this.levels.set({kind:"custom",number:p+1},q.place({x:r,y:s})),r+=110;this.btn.checkbox.place({x:50,y:-45,from:V})}route(){return"level"}onShow(){for(let[e,o]of this.levels)e.kind==="standard"&&(o.state={open:"aLevel",locked:"aLockedLevel",starred:"aStarredLevel"}[Ve(e)]);this.btn.checkbox.enabled=de(),this.btn.checkbox.state=Pe()?"checkedbox":"checkbox"}draw(){l(this.img.selectMessage,{y:-36,from:xe}),fill(0),noStroke(),textSize(35),textAlign(CENTER);for(let[e,o]of this.levels)if(o.draw(),e.kind==="standard"){let{x:r,y:s}=o.resolve(i);F(str(e.number),{x:r,y:s+15})}this.btn.checkbox.enabled&&(this.btn.checkbox.draw(),textSize(16),textAlign(LEFT),F("Max Density",{x:85,y:-55,from:V}))}mousePressed(){for(let[e,o]of this.levels)if(o.hover()){d(n,L(e));return}this.btn.checkbox.hover()&&(this.btn.checkbox.toggle(),De(this.btn.checkbox.state==="checkedbox"))}},w=pe;h(w,"layers",[g,pe,c]);var ye=class{img=u("help");btn=b("play","levelSelect","instructions","levelEditor","ok");showHelp=!1;constructor(){let e=0,o=()=>({y:230+e++*80,from:$,anchor:i});this.btn.play.place(o()),this.btn.levelSelect.place(o()),this.btn.instructions.place(o()),this.btn.levelEditor.place(o()),this.btn.ok.place({x:-210,y:145,from:i,anchor:v})}route(){return""}draw(){this.btn.play.draw(),this.btn.levelSelect.draw(),this.btn.instructions.draw(),this.btn.levelEditor.draw(),this.showHelp&&(N(this.img.help),this.btn.ok.draw())}mousePressed(){this.showHelp?this.btn.ok.hover()&&(this.showHelp=!1):this.btn.play.hover()?d(n,L(Te())):this.btn.levelSelect.hover()?d(w):this.btn.instructions.hover()?this.showHelp=!0:this.btn.levelEditor.hover()&&d(m,L(Ce()))}},S=ye;h(S,"layers",[g,ye]);function W(...t){location.hash=t.join("-")}var he=class{onShow(e){switch(e.desc.kind){case"standard":W(e.desc.number);break;case"custom":W("custom",e.desc.number);break}}draw(){color(255)}},n=he;h(n,"layers",[he,c]);ge(globalThis,{view:S,preload:[n,w,m],setup(){createCanvas(800,600),textFont("Arial")},draw(){background(me)}});})();
//# sourceMappingURL=app.js.map
